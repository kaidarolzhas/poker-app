<!DOCTYPE html>
<html lang="en" ng-app="loginApp">
<head>
    <meta charset="UTF-8">
    <title>Login / Signup</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="bower_components/angular/angular.min.js"></script>
</head>
<body ng-controller="loginController">

<div class="container mt-5" style="max-width: 400px;">
    <div class="card p-4">
        <h2 class="mb-4">Signup</h2>

        <div class="alert alert-warning" ng-if="errorMessage">
            {{ errorMessage }}
        </div>

        <form ng-submit="handleSubmit()">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="Username" ng-model="username" required>
            </div>
            <div class="form-group">
                <input type="password" class="form-control" ng-attr-placeholder="'Create password'" ng-model="password" required>
            </div>
            <button type="submit" class="btn btn-primary btn-block">
                Signup
            </button>
        </form>

        <div class="mt-3 text-center">
            <span>
                Already have an account?
                <a href="/login.html">Login</a>
            </span>
        </div>
    </div>
</div>

<script>
    const app = angular.module('loginApp', []);

    app.controller('loginController', function($scope, $http) {
        $scope.username = '';
        $scope.password = '';
        $scope.errorMessage = '';

        $scope.handleSubmit = function() {
            $scope.errorMessage = ''; // очищаем перед отправкой

            const payload = {
                username: $scope.username,
                password: $scope.password
            };

            $http.post('/signup', payload).then(function(response) {
                window.location.href = "index.html?username=" + encodeURIComponent($scope.username);
            }, function(error) {
                if (error.data && error.data.errors && error.data.errors.length > 0) {
                    $scope.errorMessage = error.data.errors[0].defaultMessage;
                } else if (error.data && error.data.message) {
                    $scope.errorMessage = error.data.message;
                } else {
                    $scope.errorMessage = "Signup failed. Please try again.";
                }
            });
        };
    });

</script>

</body>
</html>
